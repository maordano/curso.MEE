---
title: "selección natural"
author: "Santiago Benitez-Vieyra"
date: "noviembre 2014"
output:
  ioslides_presentation:
    keep_md: yes
    logo: /home/santiago/Dropbox/Photos/g3458.png
runtime: shiny
---

# On the origin of species |Chap. 4. pp. 80-81

***
<div class="blue3">
> Let it be borne in mind in what an endless number of strange peculiarities our domestic productions, and, in a lesser degree, those under nature, vary; and how strong the hereditary tendency is. (???)  how infinitely complex and close-fitting are the mutual relations of all organic beings to each other and to their physical conditions of life. Can it, then, be thought improbable, seeing that variations useful to man have undoubtedly occurred, that other variations useful in some way to each being in the great and complex battle of life, should sometimes occur in the course of thousands of generations? If such do occur, can we doubt (remembering that many more individuals are born than can possibly survive) that individuals having any advantage, however slight, over others, would have the best chance of surviving and of procreating their kind? On the other hand, we may feel sure that any variation in the least degree injurious would be rigidly destroyed. This preservation of favourable variations and the rejection of injurious variations, I call Natural Selection. 

</div> 
***
<div class="blue3">
* [heritable] variations (...) should sometimes occurr.
* (...) many more individuals are born than can possibly survive. 
* individuals having any advantage (...) would have the best chance of surviving and of procreating their kind
</div> 
<div class="red2">
* How strong the hereditary tendency is (?)
</div> 

## Mendel 1865 (1900)
![mendel](http://upload.wikimedia.org/wikipedia/commons/d/d3/Gregor_Mendel.png)

## Síntesis Moderna 
*Fisher (1918) The Correlation Between Relatives on the Supposition of Mendelian Inheritance*  

![sm](http://objetos.unam.mx/biologia/antecedentesEvolucion/img/fichas/poblaciones.png)

## Rasgos cuantitativos |Modelo infinitesimal de Fisher

```{r, echo =FALSE}
library(shiny)
library(ggplot2)
sidebarLayout(
sidebarPanel(
sliderInput("genes", label = "genes", min=1, max=15, value =2, step = 1), 
sliderInput("ale", label = "alelos", min=2, max=5, value =2, step = 1), width = 3),
mainPanel(
renderPlot({
if(input$ale*input$genes < 31){  
      alelos <- seq(0,input$ale-1)
      lista<- list(input$genes)
      for(i in 1:input$genes) lista[[i]]<-alelos
      tab <- expand.grid(lista)
      phenotype <- apply(tab, 1, sum)
      G <- ggplot(data=data.frame(phenotype), aes(x=phenotype)) + geom_histogram()
      G <- G + theme_bw()
      suppressMessages(print(G))} else {
        plot.new()
        text(0.5, 0.5, "demasiadas combinaciones")
      }
      }), width = 9), position = "left")

``` 

# Selección sobre caracteres cuantitativos

## Diferenciales de selección |lineal $s_{i}$ y cuadrática $c_{i}$
```{r eval=TRUE, echo=FALSE}
library(shiny)
library(ggplot2)
library(gridExtra, quietly =T)
sidebarLayout(
sidebarPanel(
selectInput("tipo", label ="tipo de selección", 
            choices=c(positiva = "Zp", negativa = "Zn", estabilizadora = "Ze", disruptiva = "Zd")),
sliderInput("SOB", label = "% post selección", min=1, max=100, value = 100, step = 1), width = 3),
mainPanel(
renderPlot({
  H <- input$SOB/100
  N <- 200
  Z <- rnorm(N)
  Zp <- Z[Z > quantile(Z, probs = 1-H)]
  Zn <- Z[Z < quantile(Z, probs = H)]
  Ze <- Z[Z > quantile(Z, probs = (1-H)/2) & Z < quantile(Z, probs = H + (1-H)/2)]
  Zd <- Z[Z < quantile(Z, probs = (H)/2) | Z > quantile(Z, probs = 1-(H/2))]
  dat1 <- data.frame(Z,
                     Zp = c(Zp, rep(NA, N-length(Zp))),
                     Zn = c(Zn, rep(NA, N-length(Zn))),
                     Ze = c(Ze, rep(NA, N-length(Ze))),
                     Zd = c(Zd, rep(NA, N-length(Zd))))
  dat2 <- data.frame(ind = c(dat1$Z, dat1[, input$tipo]),
                     pres = c(rep("antes", N), rep("despues", N)),
                     Y = rep(0, N*2))  
  o <- order(dat2$ind)
  m <- qplot(ind, ..count.., data= dat2, geom="density", fill=pres, adjust = 4) 
  m <- m + geom_vline(xintercept = 0) 
  m <- m + geom_vline(xintercept = mean(subset(dat2$ind, dat2$pres == "despues"), na.rm=T))
  m <- m + xlim(-5, 5) + theme_bw() 
  m <- m + theme(legend.position="top", axis.text.y=element_blank(), 
                 axis.title.y = element_blank(), axis.title.x = element_blank(),
                 legend.title = element_blank()) 
  
  n <- qplot(x=ind, y = Y, data=dat2[o,], geom="point", color =pres, position="jitter")
  n  <- n + geom_segment(aes(x = 0, y = 0, 
                             xend = mean(subset(dat2$ind, dat2$pres == "despues"), na.rm=T),
                             yend = 0, size=4), color ="black") 
  n <- n + xlim(-5, 5) + theme_bw()
  n <- n + theme(legend.position="none", axis.title.y=element_blank(), 
                 axis.text.y=element_blank()) 
  
  k <- qplot(x=ind, y = Y, data=dat2[o,], geom="point", color =pres, position="jitter")
  k  <- k + geom_segment(aes(x = -1, y = 0.2, xend = 1, yend = 0.2, size = 4), 
                         color ="red") 
  k  <- k + geom_segment(aes(y= -0.2, yend= -0.2,
                           x = - sd(subset(dat2$ind, dat2$pres == "despues"), na.rm=T),
                           xend = sd(subset(dat2$ind, dat2$pres == "despues"), na.rm=T),
                           size = 4), color ="blue") 
  k <- k + xlim(-5, 5) + theme_bw()
  k <- k + theme(legend.position="none", axis.title.y=element_blank(), 
                axis.text.y=element_blank()) 
  
  grid.arrange(m, n, k, heights=c(3/5, 1/5, 1/5), ncol=1)
  }), width = 9), position = "left")
``` 

***

* Esta primera simulación corresponde a selección utilizando una medida de fitness binaria (sobreviven/no sobreviven).
* En este caso es fácil calcular las medias poblacionales antes y depués del evento selectivo.
* Pero qué ocurre cuando el fitness tiene valores diferentes de 0 y 1? 

## Ecuación de Price (1970)

> An equation is presented which gives gene-frequency change under selection from one generation to the next for a single gene or for any linear function of any number of genes at any number of loci. The equation "holds for any sort of dominance or epistasis, for sexual or asexual reproduction, for random or nonrandom mating, for diploid, haploid or polyploid species." The derivation of the equation is given.
  
$\Delta \bar{z} = \bar{z}' - \bar{z}$  
$\Delta \bar{z} = \sum q'_{i} z'_{i} - \sum q_{i} z_{i}$  
$\Delta \bar{z} = \sum q'_{i} (z'_{i} - z_{i}) + \sum q'_{i} z_{i} - \sum q_{i} z_{i}$  
$\Delta \bar{z} = \sum q'_{i} (\Delta z_{i}) + \sum (\Delta q_{i}) z_{i}$  
  
<div class="blue2">  
$\sum q'_{i} (\Delta z_{i}) = \sum q_{i} (w / \bar{w}) (\Delta z_{i}) = E (w \Delta z) / \bar{w}$  
</div>
  
<div class="red2">
$\sum (\Delta q_{i}) z_{i} = \sum q_{i} (w / \bar{w} -1) z_{i} = cov(w / \bar{w}, z)$  
</div>

<div class="red2">
##$s_{i} = cov(w, z)$
</div>

```{r eval=TRUE, echo=FALSE}
library(shiny)
library(ggplot2)
library(gridExtra, quietly =T)
sidebarLayout(
sidebarPanel(
sliderInput("dif", label = "diferencial s", min=-2, max=2, value = 0, step = 0.01), width = 3),
mainPanel(
renderPlot({
Z <- rnorm(100)
W <- 10 + input$dif*Z + rnorm(100, sd=0.4)

a <- qplot(x=Z, y = W, geom="point") 
a <- a + geom_smooth(method="lm") + theme_bw() + ylim(6.5, 12)

ZZ <- data.frame(Z = c(Z, Z + input$dif), X= c(rep("antes", 100), rep("después", 100)))

b <- qplot(Z, ..count.., geom="density", data = ZZ, adjust = 4, fill= X) 
b <- b + theme_bw() + theme(legend.position = "top",  legend.title = element_blank())
b <- b + geom_vline(xintercept = 0) 
b <- b + geom_vline(xintercept = mean(subset(ZZ$Z, ZZ$X == "después"), na.rm=T))

grid.arrange(a, b, ncol=2)
  }), width = 9), position = "left")
``` 

# Introduciendo la heredabilidad

## 
```{r eval=TRUE, echo=FALSE}
library(shiny)
library(ggplot2)
library(gridExtra, quietly =T)
sidebarLayout(
sidebarPanel(
sliderInput("dif", label = "diferencial", min=-2, max=2, value = 2, step = 0.01), 
sliderInput("her", label = "heredabilidad", min=0, max=1, value = 1, step = 0.01), 
width = 3),
mainPanel(
renderPlot({
Z <- rnorm(100)

#ZZ <- data.frame(Z = c(Z, Z + 2, Z + 2*0.8), X= c(rep("antes", 100), rep("después", 100), rep("hijos", 100)))
s <- input$dif
h <- input$her
ZZ <- data.frame(Z = c(Z, Z + s, Z + s*h), X= c(rep("antes", 100), rep("después", 100), rep("hijos", 100)))

b <- qplot(Z, ..count.., geom="density", data = ZZ, adjust = 3, color= X) 
b <- b + theme_bw() + theme(legend.position = "top",  legend.title = element_blank())
b <- b + geom_vline(xintercept = 0) + xlim(c(-5,5))
#b <- b + geom_vline(xintercept = mean(subset(ZZ$Z, ZZ$X == "después"), na.rm=T), color ="blue")
#b <- b + geom_vline(xintercept = mean(subset(ZZ$Z, ZZ$X == "hijos"), na.rm=T), color="red")
b


#m <- qplot(ind, ..count.., data= dat2, geom="density", fill=pres, adjust = 4) 
#  m <- m + geom_vline(xintercept = 0) 
#  m <- m + geom_vline(xintercept = mean(subset(dat2$ind, dat2$pres == "despues"), na.rm=T))
#  m <- m + xlim(-5, 5) + theme_bw() 
#  m <- m + theme(legend.position="top", axis.text.y=element_blank(), 
#                 axis.title.y = element_blank(), axis.title.x = element_blank(),
#                legend.title = element_blank()) 
  

  }), width = 9), position = "left")
``` 
